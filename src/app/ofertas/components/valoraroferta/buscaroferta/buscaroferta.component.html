<form class="Fondo">
    <br><br>
    <div class="container bg-white">
        <h1 class="br">Buscar Oferta</h1>
        <div class="row justify-content-center">
            <img src="./../../../../../assets/ImagenesAgroApoya2Admin/barra1.png" style="width: 65%;">
        </div>
        <br>
        <div class="row">
            <div class="col-sm-4 br">
                <ng-autocomplete [data]="ArrayProductos" [searchKeyword]="producto" placeholder="Producto"
                    (selected)='selectProducto($event)' (inputCleared)="LimpiarCampos('pd')"
                    [itemTemplate]="templateRes" [notFoundTemplate]="templateVacio">
                </ng-autocomplete>

                <ng-template #templateRes let-item id="templateRes">
                    <a [innerHTML]="item.des_producto"></a>
                </ng-template>

                <ng-template #templateVacio let-SinRegistro>
                    <label for="">Sin registros</label>
                </ng-template>
            </div>

            <div class="col-sm-4 br">
                <ng-autocomplete [data]="ArrayProductor" [searchKeyword]="productor" placeholder="Productor"
                    (selected)='selectProductor($event)' (inputCleared)="LimpiarCampos('pt')"
                    [itemTemplate]="templateResPr" [notFoundTemplate]="templateVacioPr">
                </ng-autocomplete>

                <ng-template #templateResPr let-item id="templateResPr">
                    <a [innerHTML]="item.nombre_persona"></a>
                </ng-template>

                <ng-template #templateVacioPr let-SinRegistro>
                    <label for="">Sin registros</label>
                </ng-template>
            </div>
            <div class="col-sm-4 br">
                <ng-autocomplete [data]="ArrayEstado" [searchKeyword]="estado" placeholder="Estado"
                    (selected)='selectEstado($event)' (inputCleared)="LimpiarCampos('es')"
                    [itemTemplate]="templateResEs" [notFoundTemplate]="templateVacioPr">
                </ng-autocomplete>

                <ng-template #templateResEs let-item id="templateResEs">
                    <a [innerHTML]="item.DSCRPCION_ESTADO"></a>
                </ng-template>

                <ng-template #templateVacioEs let-SinRegistro>
                    <label for="">Sin registros</label>
                </ng-template>
            </div>

        </div>
        <div class="row br">
            <div class="col-sm-4 br">
                <input placeholder="Fecha oferta" type="text" class="form-control form-control-sm textBox"
                    onfocus="(this.type='date')" onblur="(this.type='date')" [(ngModel)]="FechaOferta"
                    name="FechaOferta">
            </div>
            <div class="col-sm-4 br">
                <input placeholder="Número oferta" type="text" class="form-control form-control-sm textBox"
                    [(ngModel)]="NoOferta" name="NoOferta">
            </div>
        </div>
        <div class="row br justify-content-center mt-3">
            <div class="col-sm-3 col-12 br">
                <button class="col-sm-12 btn btn-agro-prin" (click)="Buscar(templateBuscar)">Buscar</button>
            </div>
            <div class="col-sm-3 col-12 br">
                <button class="col-sm-12 btn btn-agro-sec" (click)="Limpiar()">Limpiar</button>
            </div>
        </div>
        <hr>
        <div class="row justify-content-center br tarjetadetalle" *ngFor="let oferta of ArrayOferta">
            <div class="row m-2">
                <div class="col-sm-3">
                    <img src={{RutaImagen+oferta.IMAGEN}} class="col-sm-12 ImgOferta">
                </div>
                <div class="col-sm-9">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave TextMay">Codigo oferta:&nbsp;</label><label
                                        class="ValorIDOfer"><strong>{{NoOferta}}</strong></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Producto:&nbsp;</label><label
                                        class="Valor">{{oferta.Nombre_Producto}}</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Presentación empaque:&nbsp;</label><label
                                        class="Valor">{{oferta.Descripcion_empaque}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Tamaño:&nbsp;</label><label
                                        class="Valor">{{oferta.Nmbre_tamano}}</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Condición entrega:&nbsp;</label> <label
                                        class="Valor">{{oferta.Tamano}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Valor unidad:&nbsp;</label><label
                                        class="Valor">{{oferta.VR_UNDAD_EMPQUE}}</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Unidades disponibles:&nbsp;</label><label
                                        class="Valor">{{oferta.Unidades_disponibles}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label class="Llave">Valor total oferta:&nbsp;</label><label
                                class="Valor">{{oferta.VR_TOTAL_OFRTA}}</label>
                        </div>
                        <div class="col-sm-6">
                            <label class="Llave">Valor costeo:&nbsp;</label><label
                                class="Valor">{{oferta.vlor_costeo}}</label>
                        </div>
                    </div>
                    <hr class="hrSinEstilo">
                    <div class="row">
                        <div class="col-sm-12">
                            <label class="Llave">Descripción producto:&nbsp;</label><label
                                class="Valor">{{oferta.caracteristicas}}</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <label class="Llave">Caracterización:&nbsp;</label><label
                                class="Valor">{{oferta.caracterizacion}}</label>
                        </div>
                    </div>
                    <hr class="hrSinEstilo">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Fecha recogida:&nbsp;</label><label
                                        class="Valor">{{oferta.fecha_recogida}}</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Jornada:&nbsp;</label><label
                                        class="Valor">{{oferta.Nombre_jornada}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <label class="Llave">Nombre productor:&nbsp;</label><label
                                class="Valor">{{oferta.Nombre_productor}}</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Ubicación:&nbsp;</label><label
                                        class="Valor">{{oferta.Ubicacion_parsela +'
                                        ('+oferta.coordenadas_parcela}})</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label class="Llave">Estado oferta:&nbsp;</label><label
                                        class="Valor">{{NomEstado}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row justify-content-center">
                <div class="col-sm-1">
                    <button class="SinEstilo" (click)="EditaOferta(templateEditar)">
                        <img src="./../../../../../assets/ImagenesAgroApoya2Admin/Editar.png" title="Editar oferta">
                    </button>
                    <label>Editar</label>
                </div>
                <div class="col-sm-1">
                    <button class="SinEstilo" (click)="CerrarOferta(templateCerrar)">
                        <img src="./../../../../../assets/ImagenesAgroApoya2Admin/Cerrar.png" title="Cerrar oferta">
                    </button>
                    <label>Cerrar</label>
                </div>
                <div class="col-sm-2">
                    <button class="SinEstilo" disabled>
                        <img src={{ImagenEstado}} title="Estado oferta">
                    </button>
                    <label>{{EstadoOferta}}</label>
                </div>
            </div>
        </div>
        <div class="row br justify-content-center mt-3" *ngIf="ValidaBusqueda == '1'">
            <div class="col-sm-3 col-12 br">
                <button class="col-sm-12 btn btn-agro-prin" (click)="Enviar()">Siguiente</button>
            </div>
        </div>
        <br><br>
    </div>
    <ng-template #templateEditar let-modal>
        <div class="modal-header">
            <h1 class="modal-title" id="modal-basic-title">Editar oferta</h1>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
        </div>
        <div class="modal-body">
            <div class="row br">
                <div class="col-sm-12">
                    <label class="col-sm-12 Llave">Caractrización</label>
                    <textarea name="ECaracteriza" id="ECaracteriza"
                        class="col-sm-12 form-control form-control-sm textArea" placeholder="Caracterización" rows="3"
                        [(ngModel)]="ECaracteriza"></textarea>
                </div>
            </div>
            <div class="row br">
                <div class="col-sm-12">
                    <label class="col-sm-12 Llave">Fecha Recogida</label>
                    <input type="date" class="col-sm-12 form-control form-control-sm textBox"
                        placeholder="Fecha recogida" onfocus="(this.type='date')" onblur="(this.type='date')"
                        [(ngModel)]="EFechaRecogida" name="EFechaRecogida">
                </div>
            </div>
            <div class="row br">
                <div class="col-sm-12">
                    <label class="col-sm-12 Llave">Jornada</label>
                    <select name="EJornada" id="EJornada" #ejornada class="form-control form-control-sm textBox"
                        (change)='SelEJornada(ejornada.value)'>
                        <option value="1">Jornada</option>
                        <option *ngFor="let jornada of ArrayJornada" [value]="jornada.CD_JRNDA" [selected]="jornada.CD_JRNDA == EJornada">
                            {{jornada.DESCRIPCION}}
                        </option>
                    </select>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <button type="button" class="btn btn-agro-prin col-sm-2"
                (click)="AceptaEditar(ModalRespuesta)">Guardar</button>
        </div>
        <br>
    </ng-template>
    <ng-template #templateCerrar let-modal>
        <div class="modal-header">
            <h1 class="modal-title" id="modal-basic-title">Cerrar oferta</h1>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
        </div>
        <div class="modal-body">
            <div class="row br">
                <div class="col-sm-12">
                    <textarea [(ngModel)]="mcObservacion" name="mcObservacion" id="mcObservacion"
                        class="Col-sm-12 form-control form-control-sm textArea" placeholder="Observación"
                        rows="3"></textarea>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <button type="button" class="btn btn-agro-prin col-sm-2"
                (click)="AceptaCerrar(ModalRespuesta)">Guardar</button>
        </div>
        <br>
    </ng-template>
    <!-- Template Modal Buscar-->
    <ng-template #templateBuscar let-modal>
        <div class="modal-header">
            <h1 class="modal-title" id="modal-basic-title">Selecciona oferta</h1>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
        </div>
        <div class="moda-body">
            <ul>
                <li *ngFor="let seleccion of ArrayBusqueda" class="row br">
                    <div class="col-sm-10">
                        <input type="text"
                            value="{{seleccion.cd_cnsctvo}} - {{seleccion.Producto}} - {{seleccion.NombreCompletoProductor}} - {{seleccion.VigenciaDesde}}"
                            class="form-control" disabled>
                    </div>
                    <div class="col-sm-1">
                        <button class="bot col-sm-1 SinEstilo" (click)="CargaBusqueda(seleccion)">
                            <img src="./../../../../../assets/ImagenesAgroApoya2Admin/Editar.png" alt="Ver">
                        </button>
                    </div>
                </li>
            </ul>
            <div class="row br">
                <div class="col-sm-12">
                    <h2 class="TituloDetalle">{{Respuesta}}</h2>
                </div>
            </div>
            <br>
            <div class="row justify-content-center">
                <button type="button" class="btn btn-agro-prin col-sm-2" (click)="modal.close()">Aceptar</button>
            </div>
            <br>
        </div>
    </ng-template>
    <ng-template #ModalRespuesta let-modal>
        <div class="modal-header">
            <h1>Respuesta</h1>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
        </div>
        <div class="modal-body">
            <div class="row br">
                <div class="col-sm-12">
                    <h2 class="TituloDetalle">{{Respuesta}}</h2>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <button type="button" class="btn btn-agro-prin col-sm-2" (click)="modal.close()">Aceptar</button>
        </div>
        <br>
    </ng-template>
</form>